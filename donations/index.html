<!DOCTYPE html>
<html lang="en" id="">

<head>
<script>document.documentElement.id = localStorage.getItem('dark') !== null ? 'dark' : 'light';</script>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="theme-color" content="#000000" />
<link rel="stylesheet" type="text/css" href="/assets/styles/main.css" />
<link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/assets/fonts/mulish.woff2" />
<link rel="icon" type="image/x-icon" href="/favicon.ico" />
<!-- <link rel="manifest" href="/assets/manifest.json" /> -->

<title>Kaspa Donation Link</title>
<meta name="twitter:title" content="Kaspa Donation Link" />
<meta property="og:title" content="Kaspa Donation Link" />

<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://kaspahub.org/assets/logo.jpg" />
<meta property="og:image" content="https://kaspahub.org/assets/logo.jpg" />

<meta name="twitter:site" content="@KaspaHub" />

</head>

<body>

<nav id="navBar"><input id="menu" type="button" aria-label="Menu Toggle" onclick="menu()" /><a id="title" href="/">Kaspa Hub</a><input id="theme" type="checkbox" aria-label="Theme Toggle" onclick="theme()" /></nav><script async src="/assets/scripts/main.js"></script>

<main id="container-1">
	<h1 id="page-title">Kaspa Donations</h1>
	<div id="text-display" class="theme-1">...</div>
	<div class="qr-code" id="qr-code"></div>
	<button class="button" id="copy-button" style="display:none;">Copy Wallet Address</button>
	<a class="button" id="open-button" style="display: none;" href="" target="_blank">Open Wallet</a>
</main>

<style type="text/css">
main {
	display: flex;
	flex-direction: column;
	align-items: center;
}
#page-title {
	margin-bottom: 20px;
}
#text-display {
	max-width: 600px;
	text-align: center;
	font-size: 1.2rem;
	word-break: break-all;
	word-wrap: break-word;
}
#open-button {
	color: white;
	text-decoration: none;
	font-weight: inherit;
}
.button {
	width: 200px;
	margin: 20px 0;
}
</style>

<script src="/assets/scripts/jquery.js"></script>
<script src="/assets/scripts/jquery-qrcode.js"></script>
<script type="module">
import { items as users } from 'https://kaspahub.github.io/directory/users.js';
//https://cdn.jsdelivr.net/gh/KaspaHub/directory@latest/users.js

document.addEventListener("DOMContentLoaded", () => {
	const urlParams = new URLSearchParams(window.location.search);
	const handleRaw = urlParams.get('handle');

	const displayElement = document.getElementById("text-display");
	const titleElement = document.getElementById("page-title");
	const qrCodeElement = document.getElementById("qr-code");
	const copyButton = document.getElementById("copy-button");
	const openButton = document.getElementById("open-button");

	function setMetaTag(name, content) {
		const meta = document.createElement('meta');
		meta.setAttribute('name', name);
		meta.setAttribute('content', content);
		document.head.appendChild(meta);
	}

	if (!handleRaw) {
		displayElement.textContent = "Missing X handle in the URL. Use ?handle=YourXHandle";
		return;
	}

	const user = users.find(u => u.x?.toLowerCase() === handleRaw.toLowerCase());

	if (!user) {
		displayElement.innerHTML = `<span class='error'>No user found with X handle <strong>@${handleRaw}</strong>.<br> Check <a href="https://github.com/KaspaHub/directory">Github directory</a> & add your wallet!</span>`;
		return;
	}

	document.title = `@${user.x}`;
	titleElement.innerHTML = `<a href="https://x.com/${user.x}" target="_blank" rel="noopener noreferrer">@${user.x}</a>`;
	setMetaTag('kaspa:title', '@' + user.x);

	let displayText = user.wallet;
	if (user.domain) {
		displayText += `<br><br><span style="font-size: 1rem; opacity: 0.75;">${user.domain}</span>`;
	}

	displayElement.innerHTML = displayText;

	$('#qr-code').qrcode({
		render: 'image',
		text: user.wallet,
		size: 256,
		quiet: 3
	});

	copyButton.style.display = "inline-block";
	copyButton.addEventListener('click', () => {
		navigator.clipboard.writeText(user.wallet).then(() => {
			const originalText = copyButton.textContent;
			copyButton.textContent = 'Copied!';
			setTimeout(() => {
				copyButton.textContent = originalText;
			}, 1500);
		});
	});

	if (window.innerHeight > window.innerWidth) {
		openButton.style.display = "inline-block";
		openButton.href = user.wallet;
	}

	setMetaTag('kaspa:wallet', user.wallet);
});
</script>

</body>
</html>