<!DOCTYPE html>
<html lang="en" id="">

<head>
<script>document.documentElement.id = localStorage.getItem('dark') !== null ? 'dark' : 'light';</script>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="theme-color" content="#000000" />
<link rel="stylesheet" type="text/css" href="/assets/styles/main.css" />
<link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/assets/fonts/mulish.woff2" />
<link rel="icon" type="image/x-icon" href="/favicon.ico" />
<!-- <link rel="manifest" href="/assets/manifest.json" /> -->

<title>Kaspa Donation Link</title>
<meta name="twitter:title" content="Kaspa Donation Link" />
<meta property="og:title" content="Kaspa Donation Link" />

<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://kaspahub.org/assets/logo.jpg" />
<meta property="og:image" content="https://kaspahub.org/assets/logo.jpg" />

<meta name="twitter:site" content="@KaspaHub" />

</head>

<body>

<nav id="navBar"><input id="menu" type="button" aria-label="Menu Toggle" onclick="menu()" /><a id="title" href="/">Kaspa Hub</a><input id="theme" type="checkbox" aria-label="Theme Toggle" onclick="theme()" /></nav><script async src="/assets/scripts/main.js"></script>

<main id="container-1">
	<h1 id="page-title">Kaspa Donations</h1>
	<div id="text-display" class="theme-1">...</div>
	<div class="qr-code" id="qr-code"></div>
	<button class="button" id="copy-button" style="display:none;">Copy Wallet Address</button>
	<a class="button" id="open-button" style="display: none;" href="" target="_blank">Open Wallet</a>
</main>

<style type="text/css">
main {
	display: flex;
	flex-direction: column;
	align-items: center;
}
#page-title {
	margin-bottom: 20px;
}
#text-display {
	max-width: 600px;
	text-align: center;
	font-size: 1.2rem;
	word-break: break-all;
	word-wrap: break-word;
}
.button {
	width: 200px;
	margin: 20px 0;
}
#open-button {
	color: white;
	text-decoration: none;
	font-weight: inherit;
}
</style>

<script src="/assets/scripts/jquery.js"></script>
<script src="/assets/scripts/jquery-qrcode.js"></script>
<script type="text/javascript">
'use strict';
document.addEventListener("DOMContentLoaded", () => {
	const urlParams = new URLSearchParams(window.location.search);
	const rawWallet = urlParams.get("wallet");
	const rawHandle = urlParams.get("handle");
	
	const displayElement = document.getElementById("text-display");
	const titleElement = document.getElementById("page-title");
	const qrCodeElement = document.getElementById("qr-code");
	const copyButton = document.getElementById("copy-button");
	const openButton = document.getElementById("open-button");

	
	function setMetaTag(name, content) {
		const meta = document.createElement('meta');
		meta.setAttribute('name', name);
		meta.setAttribute('content', content);
		document.head.appendChild(meta);
	}

	if (rawHandle) {
		const decodedHandle = decodeURIComponent(rawHandle);
		document.title = '@' + decodedHandle;
		titleElement.innerHTML = `<a href="https://x.com/${decodedHandle}" target="_blank" rel="noopener noreferrer">@${decodedHandle}</a>`;
		setMetaTag('kaspa:title', '@' + decodedHandle);
	}

	if (rawWallet) {
		const decodedWallet = decodeURIComponent(rawWallet);
		const kaspaRegex = /^kaspa:[a-zA-Z0-9]{50,72}$/;
		
		if (!kaspaRegex.test(decodedWallet)) {
			displayElement.innerHTML = "<span class='error'>Invalid Kaspa wallet address format.</span>";
			return;
		}

	displayElement.textContent = decodedWallet;

	$('#qr-code').qrcode({
		render: 'image',
		text: decodedWallet,
		size: 256,
		quiet: 3
	});

	copyButton.style.display = "inline-block";

	copyButton.addEventListener('click', () => {
		navigator.clipboard.writeText(decodedWallet).then(() => {
			const originalText = copyButton.textContent;
			copyButton.textContent = 'Copied!';
			setTimeout(() => {
				copyButton.textContent = originalText;
			}, 1500);
		});
	});

	if (window.innerHeight > window.innerWidth) {
		openButton.style.display = "inline-block";
		openButton.href = decodedWallet;
	}
		
	setMetaTag('kaspa:wallet', decodedWallet);

	} else {
		displayElement.textContent = "No 'wallet' parameter found in the URL.";
	}
});
</script>

</body>
</html>